<!DOCTYPE html>
<html>
<head>
    <title>数据分析</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .management-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .step-container {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background-color: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .step-title {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group select, .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background-color: #e9ecef;
            border: none;
            cursor: pointer;
            flex: 1;
            text-align: center;
        }
        
        .tab.active {
            background-color: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* 数据清洗和特征提取样式 */
        .processing-instance {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
        }
        
        .processing-instance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .remove-instance {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .processing-config {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .saved-results-container {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .saved-result-item {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .saved-result-item:last-child {
            border-bottom: none;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .load-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .analysis-instance {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
        }
        
        .analysis-instance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .analysis-method-config {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .analysis-result {
            margin-top: 15px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
        }
        
        .remove-instance {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .execute-instance {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .analysis-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 1.1em;
            color: #667eea;
        }
        
        /* 穿梭框样式 */
        .transfer-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .transfer-panel {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .transfer-header {
            padding: 10px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
        }
        
        .transfer-body {
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .transfer-item {
            padding: 8px;
            cursor: pointer;
            border-radius: 3px;
            margin-bottom: 5px;
        }
        
        .transfer-item:hover {
            background: #e9ecef;
        }
        
        .transfer-item.selected {
            background: #d4edda;
        }
        
        .transfer-actions {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 10px;
            padding: 0 10px;
        }
        
        .transfer-btn {
            padding: 8px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .transfer-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .data-point-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .point-details {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .point-chart {
            flex: 2;
            min-width: 300px;
        }
        
        .point-stats {
            flex: 1;
            min-width: 200px;
        }
        
        .compact-chart-container {
            height: 300px;
            margin: 10px 0;
        }
        
        .data-point-checkbox {
            margin-right: 8px;
        }
        
        .conclusion-textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            resize: vertical;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .transfer-container {
                flex-direction: column;
            }
            
            .container {
                padding: 10px;
            }
            
            .management-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="project-title">分析诊断</h1>
            <p id="project-description">基于历史数据的深度分析和洞察</p>
        </div>
        
        <div class="management-container">
            <!-- 步骤1：数据导入 -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">数据导入</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="device-select">选择设备:</label>
                        <select id="device-select">
                            <option value="">请选择设备</option>
                        </select>
                    </div>
                </div>
                
                <div class="transfer-container">
                    <!-- 左侧面板 - 可用数据点 -->
                    <div class="transfer-panel">
                        <div class="transfer-header">待导入点位</div>
                        <div class="transfer-body" id="available-points-list">
                            <p>请先选择设备</p>
                        </div>
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div class="transfer-actions">
                        <button class="transfer-btn" onclick="moveSelectedPoints('right')" id="move-right-btn" disabled>添加 &gt;</button>
                        <button class="transfer-btn" onclick="moveSelectedPoints('left')" id="move-left-btn" disabled>&lt; 移除</button>
                    </div>
                    
                    <!-- 右侧面板 - 已选择数据点 -->
                    <div class="transfer-panel">
                        <div class="transfer-header">已导入点位</div>
                        <div class="transfer-body" id="selected-transfer-points-list">
                            <p>暂未选择数据点</p>
                        </div>
                    </div>
                </div>
                
                <div class="data-point-info" id="data-point-info-container" style="display: none;">
                    <h4>点位信息</h4>
                    <div class="point-details">
                        <div class="point-stats">
                            <h5>基本信息</h5>
                            <div id="point-stats-content"></div>
                        </div>
                        <div class="point-chart">
                            <h5>趋势图</h5>
                            <div class="compact-chart-container">
                                <canvas id="pointChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 步骤1.5：数据处理 -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">1.5</div>
                    <div class="step-title">数据处理</div>
                </div>
                
                <!-- 数据清洗标签页 -->
                <div class="tab-container">
                    <button class="tab active" onclick="switchTab(this, 'data-cleaning')">数据清洗</button>
                    <button class="tab" onclick="switchTab(this, 'feature-extraction')">特征提取</button>
                </div>
                
                <!-- 数据清洗内容 -->
                <div id="data-cleaning" class="tab-content active">
                    <div id="data-cleaning-instances">
                        <h4>数据清洗实例:</h4>
                        <div id="data-cleaning-list">
                            <p>暂无数据清洗实例，请添加实例</p>
                        </div>
                        <button class="btn" onclick="addDataCleaningInstance()">添加清洗实例</button>
                    </div>
                </div>
                
                <!-- 特征提取内容 -->
                <div id="feature-extraction" class="tab-content">
                    <div id="feature-extraction-instances">
                        <h4>特征提取实例:</h4>
                        <div id="feature-extraction-list">
                            <p>暂无特征提取实例，请添加实例</p>
                        </div>
                        <button class="btn" onclick="addFeatureExtractionInstance()">添加特征实例</button>
                    </div>
                </div>
            </div>
            
            <!-- 步骤2：分析诊断 -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">分析诊断</div>
                </div>
                
                <div id="analysis-instances-container">
                    <h4>分析实例:</h4>
                    <div id="analysis-instances-list">
                        <p>暂无分析实例，请添加分析实例</p>
                    </div>
                    <button class="btn" onclick="addAnalysisInstance()">添加分析实例</button>
                </div>
                
                <button class="btn" onclick="performAllAnalysis()" id="perform-analysis-btn" disabled>执行所有分析</button>
            </div>
            
            <!-- 步骤3：结论说明 -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">结论说明</div>
                </div>
                
                <textarea class="conclusion-textarea" id="conclusion-textarea" placeholder="在此输入您的分析结论..."></textarea>
            </div>
            
            <!-- 步骤4：保存分析项目 -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">保存分析项目</div>
                </div>
                
                <button class="btn" onclick="saveAnalysisProject()" id="save-project-btn">保存项目</button>
                
                <div class="saved-results-container">
                    <h4>已保存的分析结果:</h4>
                    <div id="saved-results-list">
                        <p>暂无保存的分析结果</p>
                    </div>
                </div>
            </div>
            
            <a href="/data-analysis" class="back-link">返回项目列表</a>
        </div>
    </div>
    
    <script>
        // 全局变量
        let devices = [];
        let pointChart = null;
        let projectId = {{ project_id|tojson if project_id else 'null' }};
        let availablePoints = []; // 存储当前设备的所有点位
        let selectedPoints = []; // 存储已选择的点位
        let analysisResults = []; // 存储分析结果
        let analysisInstances = []; // 存储分析实例
        let analysisInstanceIdCounter = 0; // 分析实例ID计数器
        let dataCleaningInstances = []; // 数据清洗实例
        let dataCleaningIdCounter = 0; // 数据清洗实例ID计数器
        let featureExtractionInstances = []; // 特征提取实例
        let featureExtractionIdCounter = 0; // 特征提取实例ID计数器
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadProjectDetails();
            loadDevices();
            if (projectId) {
                loadSavedAnalysisResults();
                loadAnalysisProjectData(); // 加载分析项目数据
            }
        });
        
        // 加载项目详情
        function loadProjectDetails() {
            if (projectId) {
                fetch(`/api/data-analysis-projects/${projectId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const project = data.data;
                            document.getElementById('project-title').textContent = project.name;
                            document.getElementById('project-description').textContent = project.description || '基于历史数据的深度分析和洞察';
                        }
                    })
                    .catch(error => {
                        console.error('加载项目详情失败:', error);
                    });
            }
        }
        
        // 加载设备列表
        function loadDevices() {
            fetch('/api/device-monitoring-data')
                .then(response => {
                    console.log('设备API响应状态:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('设备数据:', data); // 调试信息
                    if (data.success) {
                        devices = data.devices || []; // 确保devices是数组
                        const deviceSelect = document.getElementById('device-select');
                        deviceSelect.innerHTML = '<option value="">请选择设备</option>';
                        
                        // 检查每个设备是否有type属性
                        if (Array.isArray(devices)) {
                            devices.forEach(device => {
                                console.log('单个设备数据:', device); // 调试信息
                                if (device && device.id && device.name) {
                                    const option = document.createElement('option');
                                    option.value = device.id;
                                    option.textContent = device.name;
                                    deviceSelect.appendChild(option);
                                } else {
                                    console.warn('设备数据不完整:', device);
                                }
                            });
                        } else {
                            console.error('设备数据不是数组格式');
                            document.getElementById('device-select').innerHTML = '<option value="">设备数据格式错误</option>';
                        }
                    } else {
                        console.error('加载设备列表失败:', data.message);
                        document.getElementById('device-select').innerHTML = '<option value="">加载设备列表失败: ' + data.message + '</option>';
                    }
                })
                .catch(error => {
                    console.error('加载设备列表失败:', error);
                    document.getElementById('device-select').innerHTML = '<option value="">加载设备列表出错: ' + error.message + '</option>';
                });
        }
        
        // 当设备选择改变时
        document.getElementById('device-select').addEventListener('change', function() {
            const deviceId = this.value;
            console.log('选择的设备ID:', deviceId); // 调试信息
            loadDevicePoints(deviceId);
        });
        
        // 加载设备点位
        function loadDevicePoints(deviceId) {
            if (!deviceId) {
                document.getElementById('available-points-list').innerHTML = '<p>请先选择设备</p>';
                return;
            }
            
            // 获取设备信息
            const device = devices.find(d => d.id == deviceId);
            if (!device) {
                document.getElementById('available-points-list').innerHTML = '<p>设备信息不存在</p>';
                return;
            }
            
            console.log('设备信息:', device); // 调试信息
            
            // 检查设备是否有type属性
            if (!device.type) {
                document.getElementById('available-points-list').innerHTML = '<p>设备类型信息缺失</p>';
                return;
            }
            
            // 直接通过设备类型ID获取属性列表（使用新的API）
            // 先获取所有设备类型
            fetch('/api/device-types')
                .then(response => response.json())
                .then(data => {
                    console.log('所有设备类型:', data); // 调试信息
                    if (data.success) {
                        // 查找匹配的设备类型
                        const deviceType = data.data.find(dt => dt.name === device.type);
                        if (!deviceType) {
                            document.getElementById('available-points-list').innerHTML = '<p>找不到匹配的设备类型: ' + device.type + '</p>';
                            return;
                        }
                        
                        console.log('匹配的设备类型:', deviceType); // 调试信息
                        
                        // 通过设备类型ID获取属性列表
                        return fetch(`/api/device-types/${deviceType.id}/properties`)
                            .then(response => response.json())
                            .then(propertiesData => {
                                console.log('设备属性数据:', propertiesData); // 调试信息
                                if (propertiesData.success) {
                                    // 检查是否有data字段
                                    if (!propertiesData.data) {
                                        console.error('属性数据结构不正确，缺少data字段:', propertiesData);
                                        document.getElementById('available-points-list').innerHTML = '<p>属性数据结构不正确，缺少data字段</p>';
                                        return;
                                    }
                                    
                                    availablePoints = propertiesData.data.map(prop => ({
                                        id: prop.id,
                                        name: prop.name,
                                        deviceId: deviceId,
                                        deviceName: device.name,
                                        unit: prop.unit || ''
                                    }));
                                    
                                    renderAvailablePoints();
                                } else {
                                    document.getElementById('available-points-list').innerHTML = '<p>加载属性失败: ' + (propertiesData.message || '未知错误') + '</p>';
                                }
                            })
                            .catch(error => {
                                console.error('加载属性数据失败:', error);
                                document.getElementById('available-points-list').innerHTML = '<p>加载属性数据失败: ' + error.message + '</p>';
                            });
                    } else {
                        document.getElementById('available-points-list').innerHTML = '<p>加载设备类型失败: ' + (data.message || '未知错误') + '</p>';
                    }
                })
                .catch(error => {
                    console.error('加载设备类型失败:', error);
                    document.getElementById('available-points-list').innerHTML = '<p>加载设备类型失败: ' + error.message + '</p>';
                });
        }
        
        // 渲染可用点位
        function renderAvailablePoints() {
            const container = document.getElementById('available-points-list');
            
            console.log('可用点位:', availablePoints); // 调试信息
            
            if (availablePoints.length === 0) {
                container.innerHTML = '<p>该设备无可用点位</p>';
                return;
            }
            
            container.innerHTML = '';
            availablePoints.forEach(point => {
                const pointElement = document.createElement('div');
                pointElement.className = 'transfer-item';
                pointElement.dataset.pointId = point.id;
                pointElement.innerHTML = `
                    <label>
                        <input type="checkbox" class="data-point-checkbox" onchange="updateTransferButtons()">
                        ${point.name} (${point.unit || '无单位'})
                    </label>
                `;
                container.appendChild(pointElement);
            });
        }
        
        // 更新穿梭框按钮状态
        function updateTransferButtons() {
            const availableCheckboxes = document.querySelectorAll('#available-points-list .data-point-checkbox:checked');
            const selectedCheckboxes = document.querySelectorAll('#selected-transfer-points-list .data-point-checkbox:checked');
            
            document.getElementById('move-right-btn').disabled = availableCheckboxes.length === 0;
            document.getElementById('move-left-btn').disabled = selectedCheckboxes.length === 0;
        }
        
        // 移动选中的点
        function moveSelectedPoints(direction) {
            if (direction === 'right') {
                movePointsToRight();
            } else {
                movePointsToLeft();
            }
        }
        
        // 移动点到右侧
        function movePointsToRight() {
            const availableItems = document.querySelectorAll('#available-points-list .transfer-item');
            const selectedContainer = document.getElementById('selected-transfer-points-list');
            
            // 清除"暂未选择数据点"的提示
            if (selectedContainer.innerHTML.includes('暂未选择数据点')) {
                selectedContainer.innerHTML = '';
            }
            
            availableItems.forEach(item => {
                const checkbox = item.querySelector('.data-point-checkbox');
                if (checkbox.checked) {
                    const pointId = parseInt(item.dataset.pointId);
                    const point = availablePoints.find(p => p.id == pointId);
                    
                    if (point && !selectedPoints.find(sp => sp.id == pointId)) {
                        // 添加到已选择点位
                        selectedPoints.push(point);
                        
                        // 添加到右侧
                        const newItem = document.createElement('div');
                        newItem.className = 'transfer-item';
                        newItem.dataset.pointId = pointId;
                        newItem.innerHTML = `
                            <label>
                                <input type="checkbox" class="data-point-checkbox" onchange="updateTransferButtons()">
                                ${point.name} (${point.unit || '无单位'})
                            </label>
                        `;
                        selectedContainer.appendChild(newItem);
                        // 从左侧移除
                        item.remove();
                    }
                }
            });
            
            updateTransferButtons();
            
            // 如果有选中的点位，启用分析按钮
            if (selectedPoints.length > 0) {
                document.getElementById('perform-analysis-btn').disabled = false;
            }
            
            // 更新数据清洗实例中的点位引用
            updateDataCleaningPointReferences();
        }
        
        // 移动点到左侧
        function movePointsToLeft() {
            const selectedItems = document.querySelectorAll('#selected-transfer-points-list .transfer-item');
            const availableContainer = document.getElementById('available-points-list');
            const selectedContainer = document.getElementById('selected-transfer-points-list');
            
            selectedItems.forEach(item => {
                const checkbox = item.querySelector('.data-point-checkbox');
                if (checkbox.checked) {
                    const pointId = parseInt(item.dataset.pointId);
                    // 从已选择点位中移除
                    selectedPoints = selectedPoints.filter(p => p.id != pointId);
                    
                    // 添加到左侧
                    const point = availablePoints.find(p => p.id == pointId);
                    if (point) {
                        const newItem = document.createElement('div');
                        newItem.className = 'transfer-item';
                        newItem.dataset.pointId = pointId;
                        newItem.innerHTML = `
                            <label>
                                <input type="checkbox" class="data-point-checkbox" onchange="updateTransferButtons()">
                                ${point.name} (${point.unit || '无单位'})
                            </label>
                        `;
                        availableContainer.appendChild(newItem);
                    }
                    
                    // 从右侧移除
                    item.remove();
                }
            });
            
            // 如果右侧没有项目了，显示提示
            if (selectedContainer.children.length === 0 || 
                (selectedContainer.children.length === 1 && selectedContainer.innerHTML.includes('暂未选择数据点'))) {
                selectedContainer.innerHTML = '<p>暂未选择数据点</p>';
            }
            
            updateTransferButtons();
            
            // 如果没有选中的点位，禁用分析按钮
            if (selectedPoints.length === 0) {
                document.getElementById('perform-analysis-btn').disabled = true;
            }
            
            // 更新数据清洗实例中的点位引用
            updateDataCleaningPointReferences();
        }
        
        // 点击已选择的点位，显示信息和趋势图
        document.getElementById('selected-transfer-points-list').addEventListener('click', function(e) {
            const item = e.target.closest('.transfer-item');
            if (item) {
                // 移除其他项的选中状态
                document.querySelectorAll('#selected-transfer-points-list .transfer-item').forEach(i => {
                    i.classList.remove('selected');
                });
                
                // 添加当前项的选中状态
                item.classList.add('selected');
                
                // 显示点位信息区域
                document.getElementById('data-point-info-container').style.display = 'block';
                
                // 获取点位信息
                const pointId = parseInt(item.dataset.pointId);
                const point = selectedPoints.find(p => p.id == pointId);
                if (point) {
                    showPointInfo(point);
                }
            }
        });
        
        // 显示点位信息
        function showPointInfo(point) {
            console.log('显示点位信息:', point); // 调试信息
            
            // 显示统计数据
            document.getElementById('point-stats-content').innerHTML = `
                <p><strong>设备名称:</strong> ${point.deviceName}</p>
                <p><strong>点位名称:</strong> ${point.name}</p>
                <p><strong>单位:</strong> ${point.unit || '无'}</p>
            `;
            
            // 获取历史数据并绘制图表
            fetch(`/api/property-history/${point.deviceId}/${point.id}?limit=100`)
                .then(response => response.json())
                .then(data => {
                    console.log('历史数据:', data); // 调试信息
                    if (data.success && data.data.length > 0) {
                        renderPointChart(data.data);
                    } else {
                        renderPointChart([]);
                    }
                })
                .catch(error => {
                    console.error('获取历史数据失败:', error);
                    renderPointChart([]);
                });
        }
        
        // 渲染点位图表
        function renderPointChart(historyData) {
            const ctx = document.getElementById('pointChart').getContext('2d');
            
            // 销毁之前的图表
            if (pointChart) {
                pointChart.destroy();
            }
            
            if (historyData.length === 0) {
                pointChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: '无数据',
                            data: [],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.1,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        }
                    }
                });
                return;
            }
            
            // 准备图表数据
            const values = historyData.map(item => parseFloat(item.value));
            const labels = historyData.map(item => {
                const date = new Date(item.timestamp);
                return `${date.getMonth()+1}-${date.getDate()} ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
            });
            
            pointChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '历史数据',
                        data: values,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }
        
        // 添加分析实例
        function addAnalysisInstance() {
            const instanceId = analysisInstanceIdCounter++;
            
            const instance = {
                id: instanceId,
                type: 'descriptive', // 默认为描述性分析
                method: 'descriptive', // 默认为数据特征分析
                dataPoints: [],
                result: null
            };
            
            analysisInstances.push(instance);
            renderAnalysisInstances();
        }
        
        // 移除分析实例
        function removeAnalysisInstance(instanceId) {
            analysisInstances = analysisInstances.filter(instance => instance.id !== instanceId);
            renderAnalysisInstances();
        }
        
        // 更新分析实例类型
        function updateAnalysisType(instanceId, type) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.type = type;
                // 根据分析类型设置默认方法
                switch(type) {
                    case 'descriptive':
                        instance.method = 'descriptive';
                        break;
                    case 'diagnostic':
                    case 'predictive':
                    case 'prescriptive':
                        instance.method = ''; // 其他类型暂时没有定义具体方法
                        break;
                }
                instance.dataPoints = []; // 重置数据点
                instance.result = null; // 重置结果
                renderAnalysisInstances();
            }
        }
        
        // 更新分析实例方法
        function updateAnalysisMethod(instanceId, method) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.method = method;
                instance.dataPoints = []; // 重置数据点
                instance.result = null; // 重置结果
                renderAnalysisInstances();
            }
        }
        
        // 为分析实例添加数据点
        function addDataPointToInstance(instanceId, pointIndex) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (instance && selectedPoints && selectedPoints[pointIndex]) {
                // 检查是否已经添加了相同的数据点
                const isDuplicate = instance.dataPoints.some(dp => dp.index === pointIndex);
                if (!isDuplicate) {
                    instance.dataPoints.push({
                        index: pointIndex,
                        deviceName: selectedPoints[pointIndex].deviceName,
                        propertyName: selectedPoints[pointIndex].name
                    });
                    renderAnalysisInstances();
                }
            }
        }
        
        // 从分析实例移除数据点
        function removeDataPointFromInstance(instanceId, pointIndex) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.dataPoints = instance.dataPoints.filter(dp => dp.index !== pointIndex);
                renderAnalysisInstances();
            }
        }
        
        // 执行单个分析实例
        function executeAnalysisInstance(instanceId) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (!instance) return;
            
            // 只有描述性分析才有具体的执行方法
            if (instance.type !== 'descriptive') {
                alert('此分析类型的分析方法待定义');
                return;
            }
            
            if (instance.dataPoints.length === 0) {
                alert('请至少选择一个数据点');
                return;
            }
            
            switch (instance.method) {
                case 'descriptive':
                    if (instance.dataPoints.length !== 1) {
                        alert('数据特征分析需要选择一个数据点');
                        return;
                    }
                    performDescriptiveAnalysis(instance);
                    break;
                case 'trend':
                    if (instance.dataPoints.length !== 1) {
                        alert('趋势性分析需要选择一个数据点');
                        return;
                    }
                    performTrendAnalysis(instance);
                    break;
                case 'correlation':
                    if (instance.dataPoints.length < 2) {
                        alert('相关性分析需要选择至少两个数据点');
                        return;
                    }
                    performCorrelationAnalysis(instance);
                    break;
                default:
                    alert('未知的分析方法');
            }
        }
        
        // 执行描述性分析
        function performDescriptiveAnalysis(instance) {
            const pointIndex = instance.dataPoints[0].index;
            const point = selectedPoints[pointIndex];
            
            if (!point) {
                alert('数据点不存在');
                return;
            }
            
            // 检查是否应该使用清洗后的数据
            let useCleanedData = false;
            let cleaningConfig = null;
            
            // 查找应用于该数据点的数据清洗实例
            for (const cleaningInstance of dataCleaningInstances) {
                if (cleaningInstance.useCleanedData) {
                    if (cleaningInstance.targetType === 'all' || 
                        (cleaningInstance.targetType === 'specific' && cleaningInstance.targetPointIndex === pointIndex)) {
                        useCleanedData = true;
                        cleaningConfig = cleaningInstance.config;
                        break;
                    }
                }
            }
            
            // 获取历史数据
            fetch(`/api/property-history/${point.deviceId}/${point.id}?limit=1000`)
                .then(response => response.json())
                .then(data => {
                    console.log('描述性分析数据:', data); // 调试信息
                    if (data.success && data.data.length > 0) {
                        // 提取数值
                        let values = data.data.map(item => parseFloat(item.value)).filter(val => !isNaN(val));
                        
                        // 如果需要使用清洗后的数据，则应用数据清洗
                        if (useCleanedData) {
                            values = applyDataCleaning(values, cleaningConfig);
                        }
                        
                        if (values.length === 0) {
                            alert('没有有效的数值数据进行分析');
                            return;
                        }
                        
                        // 计算统计特征
                        const minValue = Math.min(...values);
                        const maxValue = Math.max(...values);
                        const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
                        
                        // 计算方差
                        const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
                        
                        // 计算分位数 (25%, 50%, 75%)
                        const sortedValues = [...values].sort((a, b) => a - b);
                        const q25 = sortedValues[Math.floor(sortedValues.length * 0.25)];
                        const q50 = sortedValues[Math.floor(sortedValues.length * 0.50)]; // 中位数
                        const q75 = sortedValues[Math.floor(sortedValues.length * 0.75)];
                        
                        // 保存结果
                        instance.result = {
                            type: 'descriptive',
                            stats: {
                                minValue: minValue.toFixed(2),
                                maxValue: maxValue.toFixed(2),
                                mean: mean.toFixed(2),
                                variance: variance.toFixed(2),
                                q25: q25.toFixed(2),
                                q50: q50.toFixed(2),
                                q75: q75.toFixed(2)
                            }
                        };
                        
                        renderAnalysisInstances();
                        alert('描述性分析完成');
                    } else {
                        alert('没有可用的数据进行分析');
                    }
                })
                .catch(error => {
                    console.error('分析失败:', error);
                    alert('分析失败，请查看控制台了解详情');
                });
        }
        
        // 执行趋势性分析
        function performTrendAnalysis(instance) {
            const pointIndex = instance.dataPoints[0].index;
            const point = selectedPoints[pointIndex];
            
            if (!point) {
                alert('数据点不存在');
                return;
            }
            
            // 检查是否应该使用清洗后的数据
            let useCleanedData = false;
            let cleaningConfig = null;
            
            // 查找应用于该数据点的数据清洗实例
            for (const cleaningInstance of dataCleaningInstances) {
                if (cleaningInstance.useCleanedData) {
                    if (cleaningInstance.targetType === 'all' || 
                        (cleaningInstance.targetType === 'specific' && cleaningInstance.targetPointIndex === pointIndex)) {
                        useCleanedData = true;
                        cleaningConfig = cleaningInstance.config;
                        break;
                    }
                }
            }
            
            // 获取历史数据
            fetch(`/api/property-history/${point.deviceId}/${point.id}?limit=1000`)
                .then(response => response.json())
                .then(data => {
                    console.log('趋势分析数据:', data); // 调试信息
                    if (data.success && data.data.length > 0) {
                        // 提取数值
                        let values = data.data.map(item => parseFloat(item.value)).filter(val => !isNaN(val));
                        
                        // 如果需要使用清洗后的数据，则应用数据清洗
                        if (useCleanedData) {
                            values = applyDataCleaning(values, cleaningConfig);
                        }
                        
                        if (values.length < 2) {
                            alert('数据点不足，无法进行趋势分析');
                            return;
                        }
                        
                        // 简单线性回归计算趋势
                        const n = values.length;
                        let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
                        
                        for (let i = 0; i < n; i++) {
                            const x = i;
                            const y = values[i];
                            sumX += x;
                            sumY += y;
                            sumXY += x * y;
                            sumXX += x * x;
                        }
                        
                        // 计算斜率
                        const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                        
                        // 确定趋势类型
                        let trendType = '无明显趋势';
                        if (slope > 0.1) {
                            trendType = '上升趋势';
                        } else if (slope < -0.1) {
                            trendType = '下降趋势';
                        }
                        
                        // 保存结果
                        instance.result = {
                            type: 'trend',
                            trend: {
                                slope: slope.toFixed(4),
                                type: trendType
                            }
                        };
                        
                        renderAnalysisInstances();
                        alert('趋势性分析完成');
                    } else {
                        alert('没有可用的数据进行分析');
                    }
                })
                .catch(error => {
                    console.error('分析失败:', error);
                    alert('分析失败，请查看控制台了解详情');
                });
        }
        
        // 执行相关性分析
        function performCorrelationAnalysis(instance) {
            if (instance.dataPoints.length < 2) {
                alert('相关性分析需要至少两个数据点');
                return;
            }
            
            // 获取所有数据点的历史数据
            const promises = instance.dataPoints.map(dp => {
                const point = selectedPoints[dp.index];
                return fetch(`/api/property-history/${point.deviceId}/${point.id}?limit=1000`)
                    .then(response => response.json())
                    .then(data => {
                        console.log(`相关性分析数据-${dp.index}:`, data); // 调试信息
                        return {
                            name: `${point.deviceName} - ${point.name}`,
                            data: data.success ? data.data : [],
                            index: dp.index
                        };
                    });
            });
            
            Promise.all(promises)
                .then(results => {
                    // 检查数据有效性
                    for (let i = 0; i < results.length; i++) {
                        if (!results[i].data || results[i].data.length === 0) {
                            alert(`数据点 ${results[i].name} 没有可用数据`);
                            return;
                        }
                    }
                    
                    // 提取数值
                    let valueArrays = results.map(result => 
                        result.data.map(item => parseFloat(item.value)).filter(val => !isNaN(val))
                    );
                    
                    // 应用数据清洗（如果需要）
                    for (let i = 0; i < valueArrays.length; i++) {
                        const pointIndex = results[i].index;
                        let useCleanedData = false;
                        let cleaningConfig = null;
                        
                        // 查找应用于该数据点的数据清洗实例
                        for (const cleaningInstance of dataCleaningInstances) {
                            if (cleaningInstance.useCleanedData) {
                                if (cleaningInstance.targetType === 'all' || 
                                    (cleaningInstance.targetType === 'specific' && cleaningInstance.targetPointIndex === pointIndex)) {
                                    useCleanedData = true;
                                    cleaningConfig = cleaningInstance.config;
                                    break;
                                }
                            }
                        }
                        
                        // 如果需要使用清洗后的数据，则应用数据清洗
                        if (useCleanedData) {
                            valueArrays[i] = applyDataCleaning(valueArrays[i], cleaningConfig);
                        }
                    }
                    
                    // 确保所有数组长度一致（取最短的）
                    const minLength = Math.min(...valueArrays.map(arr => arr.length));
                    const trimmedArrays = valueArrays.map(arr => arr.slice(0, minLength));
                    
                    // 计算协方差矩阵
                    const covMatrix = [];
                    for (let i = 0; i < trimmedArrays.length; i++) {
                        covMatrix[i] = [];
                        for (let j = 0; j < trimmedArrays.length; j++) {
                            if (i === j) {
                                // 方差
                                const mean = trimmedArrays[i].reduce((sum, val) => sum + val, 0) / trimmedArrays[i].length;
                                const variance = trimmedArrays[i].reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / trimmedArrays[i].length;
                                covMatrix[i][j] = variance.toFixed(4);
                            } else {
                                // 协方差
                                const mean1 = trimmedArrays[i].reduce((sum, val) => sum + val, 0) / trimmedArrays[i].length;
                                const mean2 = trimmedArrays[j].reduce((sum, val) => sum + val, 0) / trimmedArrays[j].length;
                                
                                let covariance = 0;
                                for (let k = 0; k < minLength; k++) {
                                    covariance += (trimmedArrays[i][k] - mean1) * (trimmedArrays[j][k] - mean2);
                                }
                                covariance /= minLength;
                                covMatrix[i][j] = covariance.toFixed(4);
                            }
                        }
                    }
                    
                    // 保存结果
                    instance.result = {
                        type: 'correlation',
                        covarianceMatrix: covMatrix,
                        dataPointNames: results.map(r => r.name)
                    };
                    
                    renderAnalysisInstances();
                    alert('相关性分析完成');
                })
                .catch(error => {
                    console.error('分析失败:', error);
                    alert('分析失败，请查看控制台了解详情');
                });
        }
        
        // 应用数据清洗
        function applyDataCleaning(values, config) {
            if (!config) return values;
            
            let cleanedValues = [...values];
            
            // 基于上下限的剔除
            if (config.lowerLimit !== null || config.upperLimit !== null) {
                cleanedValues = cleanedValues.filter(val => {
                    if (config.lowerLimit !== null && val < config.lowerLimit) return false;
                    if (config.upperLimit !== null && val > config.upperLimit) return false;
                    return true;
                });
            }
            
            // 基于方差的异常点剔除
            if (config.varianceThreshold !== null) {
                const mean = cleanedValues.reduce((sum, val) => sum + val, 0) / cleanedValues.length;
                const stdDev = Math.sqrt(cleanedValues.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / cleanedValues.length);
                const threshold = stdDev * config.varianceThreshold;
                
                cleanedValues = cleanedValues.filter(val => Math.abs(val - mean) <= threshold);
            }
            
            // TODO: 插值对齐功能需要更复杂的实现
            
            return cleanedValues;
        }
        
        // 执行所有分析
        function performAllAnalysis() {
            if (analysisInstances.length === 0) {
                alert('请至少添加一个分析实例');
                return;
            }
            
            // 检查是否有描述性分析以外的实例
            let hasNonDescriptive = false;
            analysisInstances.forEach(instance => {
                if (instance.type !== 'descriptive') {
                    hasNonDescriptive = true;
                } else {
                    executeAnalysisInstance(instance.id);
                }
            });
            
            if (hasNonDescriptive) {
                alert('注意：只有描述性分析被执行，其他类型的分析方法待定义');
            } else {
                alert('所有分析已完成');
            }
        }
        
        // 渲染分析实例
        function renderAnalysisInstances() {
            const container = document.getElementById('analysis-instances-list');
            
            if (analysisInstances.length === 0) {
                container.innerHTML = '<p>暂无分析实例，请添加分析实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            analysisInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'analysis-instance';
                
                let html = `
                    <div class="analysis-instance-header">
                        <div><strong>分析实例 #${instance.id + 1}</strong></div>
                        <div>
                            <button class="execute-instance" onclick="executeAnalysisInstance(${instance.id})">执行分析</button>
                            <button class="remove-instance" onclick="removeAnalysisInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>分析类型:</label>
                            <select onchange="updateAnalysisType(${instance.id}, this.value)">
                                <option value="descriptive" ${instance.type === 'descriptive' ? 'selected' : ''}>描述性分析</option>
                                <option value="diagnostic" ${instance.type === 'diagnostic' ? 'selected' : ''}>诊断性分析</option>
                                <option value="predictive" ${instance.type === 'predictive' ? 'selected' : ''}>预测性分析</option>
                                <option value="prescriptive" ${instance.type === 'prescriptive' ? 'selected' : ''}>决策性分析</option>
                            </select>
                        </div>
                `;
                
                // 只有描述性分析才显示方法选择
                if (instance.type === 'descriptive') {
                    html += `
                        <div class="form-group">
                            <label>分析方法:</label>
                            <select onchange="updateAnalysisMethod(${instance.id}, this.value)">
                                <option value="descriptive" ${instance.method === 'descriptive' ? 'selected' : ''}>数据特征分析</option>
                                <option value="trend" ${instance.method === 'trend' ? 'selected' : ''}>趋势性分析</option>
                                <option value="correlation" ${instance.method === 'correlation' ? 'selected' : ''}>相关性分析</option>
                            </select>
                        </div>
                    `;
                }
                
                html += `
                    </div>
                `;
                
                // 只有描述性分析才显示数据点选择
                if (instance.type === 'descriptive') {
                    html += `
                        <div class="analysis-method-config">
                            <h4>数据点选择:</h4>
                    `;
                    
                    // 显示已选择的数据点（使用复选框）
                    if (instance.dataPoints.length > 0) {
                        html += '<div>';
                        instance.dataPoints.forEach(dp => {
                            html += `
                                <div>
                                    <label>
                                        <input type="checkbox" checked disabled>
                                        ${dp.deviceName} - ${dp.propertyName}
                                    </label>
                                </div>
                            `;
                        });
                        html += '</div>';
                    } else {
                        html += '<p>暂未选择数据点</p>';
                    }
                    
                    // 显示可选择的数据点（使用复选框）
                    if (selectedPoints.length > 0) {
                        html += '<div style="margin-top: 10px;">';
                        html += '<h5>可选数据点:</h5>';
                        selectedPoints.forEach((point, index) => {
                            // 检查是否已经选择了该数据点
                            const isSelected = instance.dataPoints.some(dp => dp.index === index);
                            if (!isSelected) {
                                html += `
                                    <div>
                                        <label>
                                            <input type="checkbox" onchange="toggleDataPointSelection(${instance.id}, ${index}, this.checked)">
                                            ${point.deviceName} - ${point.name}
                                        </label>
                                    </div>
                                `;
                            }
                        });
                        html += '</div>';
                    } else {
                        html += '<p>请先导入数据点</p>';
                    }
                    
                    html += '</div>'; // end analysis-method-config
                } else {
                    // 对于其他类型的分析，显示待定义消息
                    html += `
                        <div class="analysis-method-config">
                            <p>此分析类型的分析方法待定义</p>
                        </div>
                    `;
                }
                
                // 显示分析结果（仅适用于描述性分析）
                if (instance.result && instance.type === 'descriptive') {
                    html += `
                        <div class="analysis-result">
                            <h4>分析结果:</h4>
                    `;
                    
                    if (instance.result.type === 'descriptive') {
                        const stats = instance.result.stats;
                        html += `
                            <div class="analysis-stats">
                                <div class="stat-item">
                                    <div>最小值</div>
                                    <div class="stat-value">${stats.minValue}</div>
                                </div>
                                <div class="stat-item">
                                    <div>最大值</div>
                                    <div class="stat-value">${stats.maxValue}</div>
                                </div>
                                <div class="stat-item">
                                    <div>平均值</div>
                                    <div class="stat-value">${stats.mean}</div>
                                </div>
                                <div class="stat-item">
                                    <div>方差</div>
                                    <div class="stat-value">${stats.variance}</div>
                                </div>
                                <div class="stat-item">
                                    <div>25% 分位数</div>
                                    <div class="stat-value">${stats.q25}</div>
                                </div>
                                <div class="stat-item">
                                    <div>50% 分位数</div>
                                    <div class="stat-value">${stats.q50}</div>
                                </div>
                                <div class="stat-item">
                                    <div>75% 分位数</div>
                                    <div class="stat-value">${stats.q75}</div>
                                </div>
                            </div>
                        `;
                    }
                    
                    html += '</div>'; // end analysis-result
                }
                
                instanceElement.innerHTML = html;
                container.appendChild(instanceElement);
            });
        }
        
        // 切换数据点选择
        function toggleDataPointSelection(instanceId, pointIndex, isChecked) {
            if (isChecked) {
                addDataPointToInstance(instanceId, pointIndex);
            } else {
                removeDataPointFromInstance(instanceId, pointIndex);
            }
        }
        
        // 添加数据清洗实例
        function addDataCleaningInstance() {
            const instanceId = dataCleaningInstanceIdCounter++;
            
            const instance = {
                id: instanceId,
                targetType: 'all',
                targetPointIndex: null,
                useCleanedData: false,
                config: {
                    lowerLimit: null,
                    upperLimit: null,
                    varianceThreshold: null
                }
            };
            
            dataCleaningInstances.push(instance);
            renderDataCleaningInstances();
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 更新数据清洗实例的目标类型
        function updateDataCleaningTargetType(instanceId, targetType) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetType = targetType;
                if (targetType === 'all') {
                    instance.targetPointIndex = null;
                }
                renderDataCleaningInstances();
            }
        }
        
        // 更新数据清洗实例的目标数据点
        function updateDataCleaningTargetPoint(instanceId, pointIndex) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetPointIndex = pointIndex;
                renderDataCleaningInstances();
            }
        }
        
        // 更新数据清洗实例的使用状态
        function updateDataCleaningUseState(instanceId, useCleanedData) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.useCleanedData = useCleanedData;
                renderDataCleaningInstances();
            }
        }
        
        // 更新数据清洗实例的配置
        function updateDataCleaningConfig(instanceId, config) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config = config;
                renderDataCleaningInstances();
            }
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-instances-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加数据清洗实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'data-cleaning-instance';
                
                let html = `
                    <div class="data-cleaning-instance-header">
                        <div><strong>数据清洗实例 #${instance.id + 1}</strong></div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>目标类型:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                `;
                
                // 如果目标类型为特定数据点，则显示数据点选择
                if (instance.targetType === 'specific') {
                    html += `
                        <div class="form-group">
                            <label>目标数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                <option value="null" ${instance.targetPointIndex === null ? 'selected' : ''}>请选择数据点</option>
                    `;
                    
                    // 显示可选择的数据点
                    if (selectedPoints.length > 0) {
                        selectedPoints.forEach((point, index) => {
                            html += `
                                <option value="${index}" ${instance.targetPointIndex === index ? 'selected' : ''}>${point.deviceName} - ${point.name}</option>
                            `;
                        });
                    } else {
                        html += '<option disabled>请先导入数据点</option>';
                    }
                    
                    html += `
                            </select>
                        </div>
                    `;
                }
                
                html += `
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>使用清洗后的数据:</label>
                            <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateDataCleaningUseState(${instance.id}, this.checked)">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>下限:</label>
                            <input type="number" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, { ...instance.config, lowerLimit: this.value ? parseFloat(this.value) : null })">
                        </div>
                        <div class="form-group">
                            <label>上限:</label>
                            <input type="number" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, { ...instance.config, upperLimit: this.value ? parseFloat(this.value) : null })">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>方差阈值:</label>
                            <input type="number" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, { ...instance.config, varianceThreshold: this.value ? parseFloat(this.value) : null })">
                        </div>
                    </div>
                `;
                
                instanceElement.innerHTML = html;
                container.appendChild(instanceElement);
            });
        }
        
        // 渲染选中的点位
        function renderSelectedPoints() {
            const container = document.getElementById('selected-transfer-points-list');
            
            // 清除"暂未选择数据点"的提示
            if (container.innerHTML.includes('暂未选择数据点')) {
                container.innerHTML = '';
            }
            
            if (selectedPoints.length === 0) {
                container.innerHTML = '<p>暂未选择数据点</p>';
                return;
            }
            
            // 清空容器
            container.innerHTML = '';
            
            // 添加每个选中的点位
            selectedPoints.forEach(point => {
                const pointElement = document.createElement('div');
                pointElement.className = 'transfer-item';
                pointElement.dataset.pointId = point.id;
                pointElement.innerHTML = `
                    <label>
                        <input type="checkbox" class="data-point-checkbox" onchange="updateTransferButtons()">
                        ${point.name} (${point.unit || '无单位'})
                    </label>
                `;
                container.appendChild(pointElement);
            });
            
            // 启用分析按钮
            document.getElementById('perform-analysis-btn').disabled = false;
        }
        
        // 初始化
        pointChart = null;
        analysisInstanceIdCounter = 0;
        analysisInstances = [];
        dataCleaningInstanceIdCounter = 0;
        dataCleaningInstances = [];
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('import-data-button').addEventListener('click', () => {
                const fileInput = document.getElementById('data-file-input');
                if (fileInput.files.length === 0) {
                    alert('请选择一个文件');
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const data = JSON.parse(e.target.result);
                    selectedPoints = data;
                    renderPointList();
                };
                
                reader.readAsText(file);
            });
            
            document.getElementById('point-list').addEventListener('click', (event) => {
                const pointId = event.target.getAttribute('data-point-id');
                if (pointId) {
                    const point = selectedPoints.find(p => p.id == pointId);
                    if (point) {
                        showPointInfo(point);
                    }
                }
            });
        });
        
        // 移动点到右侧
        function movePointsToRight() {
            const availableItems = document.querySelectorAll('#available-points-list .transfer-item');
            const selectedContainer = document.getElementById('selected-transfer-points-list');
            
            // 清除"暂未选择数据点"的提示
            if (selectedContainer.innerHTML.includes('暂未选择数据点')) {
                selectedContainer.innerHTML = '';
            }
            
            availableItems.forEach(item => {
                const checkbox = item.querySelector('.data-point-checkbox');
                if (checkbox.checked) {
                    const pointId = parseInt(item.dataset.pointId);
                    const point = availablePoints.find(p => p.id == pointId);
                    
                    if (point && !selectedPoints.find(sp => sp.id == pointId)) {
                        // 添加到已选择点位
                        selectedPoints.push(point);
                        
                        // 添加到右侧
                        const newItem = document.createElement('div');
                        newItem.className = 'transfer-item';
                        newItem.dataset.pointId = pointId;
                        newItem.innerHTML = `
                            <label>
                                <input type="checkbox" class="data-point-checkbox" onchange="updateTransferButtons()">
                                ${point.name} (${point.unit || '无单位'})
                            </label>
                        `;
                        selectedContainer.appendChild(newItem);
                        // 从左侧移除
                        item.remove();
                    }
                }
            });
            
            updateTransferButtons();
            
            // 如果有选中的点位，启用分析按钮
            if (selectedPoints.length > 0) {
                document.getElementById('perform-analysis-btn').disabled = false;
            }
            
            // 更新数据清洗实例中的点位引用
            updateDataCleaningPointReferences();
        }
        
        // 移动点到左侧
        function movePointsToLeft() {
            const selectedItems = document.querySelectorAll('#selected-transfer-points-list .transfer-item');
            const availableContainer = document.getElementById('available-points-list');
            const selectedContainer = document.getElementById('selected-transfer-points-list');
            
            selectedItems.forEach(item => {
                const checkbox = item.querySelector('.data-point-checkbox');
                if (checkbox.checked) {
                    const pointId = parseInt(item.dataset.pointId);
                    // 从已选择点位中移除
                    selectedPoints = selectedPoints.filter(p => p.id != pointId);
                    
                    // 添加到左侧
                    const point = availablePoints.find(p => p.id == pointId);
                    if (point) {
                        const newItem = document.createElement('div');
                        newItem.className = 'transfer-item';
                        newItem.dataset.pointId = pointId;
                        newItem.innerHTML = `
                            <label>
                                <input type="checkbox" class="data-point-checkbox" onchange="updateTransferButtons()">
                                ${point.name} (${point.unit || '无单位'})
                            </label>
                        `;
                        availableContainer.appendChild(newItem);
                    }
                    
                    // 从右侧移除
                    item.remove();
                }
            });
            
            // 如果右侧没有项目了，显示提示
            if (selectedContainer.children.length === 0 || 
                (selectedContainer.children.length === 1 && selectedContainer.innerHTML.includes('暂未选择数据点'))) {
                selectedContainer.innerHTML = '<p>暂未选择数据点</p>';
            }
            
            updateTransferButtons();
            
            // 如果没有选中的点位，禁用分析按钮
            if (selectedPoints.length === 0) {
                document.getElementById('perform-analysis-btn').disabled = true;
            }
            
            // 更新数据清洗实例中的点位引用
            updateDataCleaningPointReferences();
        }
        
        // 点击已选择的点位，显示信息和趋势图
        document.getElementById('selected-transfer-points-list').addEventListener('click', function(e) {
            const item = e.target.closest('.transfer-item');
            if (item) {
                // 移除其他项的选中状态
                document.querySelectorAll('#selected-transfer-points-list .transfer-item').forEach(i => {
                    i.classList.remove('selected');
                });
                
                // 添加当前项的选中状态
                item.classList.add('selected');
                
                // 显示点位信息区域
                document.getElementById('data-point-info-container').style.display = 'block';
                
                // 获取点位信息
                const pointId = parseInt(item.dataset.pointId);
                const point = selectedPoints.find(p => p.id == pointId);
                if (point) {
                    showPointInfo(point);
                }
            }
        });
        
        // 显示点位信息
        function showPointInfo(point) {
            console.log('显示点位信息:', point); // 调试信息
            
            // 显示统计数据
            document.getElementById('point-stats-content').innerHTML = `
                <p><strong>设备名称:</strong> ${point.deviceName}</p>
                <p><strong>点位名称:</strong> ${point.name}</p>
                <p><strong>单位:</strong> ${point.unit || '无'}</p>
            `;
            
            // 获取历史数据并绘制图表
            fetch(`/api/property-history/${point.deviceId}/${point.id}?limit=100`)
                .then(response => response.json())
                .then(data => {
                    console.log('历史数据:', data); // 调试信息
                    if (data.success && data.data.length > 0) {
                        renderPointChart(data.data);
                    } else {
                        renderPointChart([]);
                    }
                })
                .catch(error => {
                    console.error('获取历史数据失败:', error);
                    renderPointChart([]);
                });
        }
        
        // 渲染点位图表
        function renderPointChart(historyData) {
            const ctx = document.getElementById('pointChart').getContext('2d');
            
            // 销毁之前的图表
            if (pointChart) {
                pointChart.destroy();
            }
            
            if (historyData.length === 0) {
                pointChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: '无数据',
                            data: [],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.1,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        }
                    }
                });
                return;
            }
            
            // 准备图表数据
            const values = historyData.map(item => parseFloat(item.value));
            const labels = historyData.map(item => {
                const date = new Date(item.timestamp);
                return `${date.getMonth()+1}-${date.getDate()} ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
            });
            
            pointChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '历史数据',
                        data: values,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }
        
        // 添加分析实例
        function addAnalysisInstance() {
            const instanceId = analysisInstanceIdCounter++;
            
            const instance = {
                id: instanceId,
                type: 'descriptive', // 默认为描述性分析
                method: 'descriptive', // 默认为数据特征分析
                dataPoints: [],
                result: null
            };
            
            analysisInstances.push(instance);
            renderAnalysisInstances();
        }
        
        // 移除分析实例
        function removeAnalysisInstance(instanceId) {
            analysisInstances = analysisInstances.filter(instance => instance.id !== instanceId);
            renderAnalysisInstances();
        }
        
        // 更新分析实例类型
        function updateAnalysisType(instanceId, type) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.type = type;
                // 根据分析类型设置默认方法
                switch(type) {
                    case 'descriptive':
                        instance.method = 'descriptive';
                        break;
                    case 'diagnostic':
                    case 'predictive':
                    case 'prescriptive':
                        instance.method = ''; // 其他类型暂时没有定义具体方法
                        break;
                }
                instance.dataPoints = []; // 重置数据点
                instance.result = null; // 重置结果
                renderAnalysisInstances();
            }
        }
        
        // 更新分析实例方法
        function updateAnalysisMethod(instanceId, method) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.method = method;
                instance.dataPoints = []; // 重置数据点
                instance.result = null; // 重置结果
                renderAnalysisInstances();
            }
        }
        
        // 为分析实例添加数据点
        function addDataPointToInstance(instanceId, pointIndex) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (instance && selectedPoints && selectedPoints[pointIndex]) {
                // 检查是否已经添加了相同的数据点
                const isDuplicate = instance.dataPoints.some(dp => dp.index === pointIndex);
                if (!isDuplicate) {
                    instance.dataPoints.push({
                        index: pointIndex,
                        deviceName: selectedPoints[pointIndex].deviceName,
                        propertyName: selectedPoints[pointIndex].name
                    });
                    renderAnalysisInstances();
                }
            }
        }
        
        // 从分析实例移除数据点
        function removeDataPointFromInstance(instanceId, pointIndex) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.dataPoints = instance.dataPoints.filter(dp => dp.index !== pointIndex);
                renderAnalysisInstances();
            }
        }
        
        // 执行单个分析实例
        function executeAnalysisInstance(instanceId) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (!instance) return;
            
            // 只有描述性分析才有具体的执行方法
            if (instance.type !== 'descriptive') {
                alert('此分析类型的分析方法待定义');
                return;
            }
            
            if (instance.dataPoints.length === 0) {
                alert('请至少选择一个数据点');
                return;
            }
            
            switch (instance.method) {
                case 'descriptive':
                    if (instance.dataPoints.length !== 1) {
                        alert('数据特征分析需要选择一个数据点');
                        return;
                    }
                    performDescriptiveAnalysis(instance);
                    break;
                case 'trend':
                    if (instance.dataPoints.length !== 1) {
                        alert('趋势性分析需要选择一个数据点');
                        return;
                    }
                    performTrendAnalysis(instance);
                    break;
                case 'correlation':
                    if (instance.dataPoints.length < 2) {
                        alert('相关性分析需要选择至少两个数据点');
                        return;
                    }
                    performCorrelationAnalysis(instance);
                    break;
                default:
                    alert('未知的分析方法');
            }
        }
        
        // 执行描述性分析
        function performDescriptiveAnalysis(instance) {
            const pointIndex = instance.dataPoints[0].index;
            const point = selectedPoints[pointIndex];
            
            if (!point) {
                alert('数据点不存在');
                return;
            }
            
            // 检查是否应该使用清洗后的数据
            let useCleanedData = false;
            let cleaningConfig = null;
            
            // 查找应用于该数据点的数据清洗实例
            for (const cleaningInstance of dataCleaningInstances) {
                if (cleaningInstance.useCleanedData) {
                    if (cleaningInstance.targetType === 'all' || 
                        (cleaningInstance.targetType === 'specific' && cleaningInstance.targetPointIndex === pointIndex)) {
                        useCleanedData = true;
                        cleaningConfig = cleaningInstance.config;
                        break;
                    }
                }
            }
            
            // 获取历史数据
            fetch(`/api/property-history/${point.deviceId}/${point.id}?limit=1000`)
                .then(response => response.json())
                .then(data => {
                    console.log('描述性分析数据:', data); // 调试信息
                    if (data.success && data.data.length > 0) {
                        // 提取数值
                        let values = data.data.map(item => parseFloat(item.value)).filter(val => !isNaN(val));
                        
                        // 如果需要使用清洗后的数据，则应用数据清洗
                        if (useCleanedData) {
                            values = applyDataCleaning(values, cleaningConfig);
                        }
                        
                        if (values.length === 0) {
                            alert('没有有效的数值数据进行分析');
                            return;
                        }
                        
                        // 计算统计特征
                        const minValue = Math.min(...values);
                        const maxValue = Math.max(...values);
                        const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
                        
                        // 计算方差
                        const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
                        
                        // 计算分位数 (25%, 50%, 75%)
                        const sortedValues = [...values].sort((a, b) => a - b);
                        const q25 = sortedValues[Math.floor(sortedValues.length * 0.25)];
                        const q50 = sortedValues[Math.floor(sortedValues.length * 0.50)]; // 中位数
                        const q75 = sortedValues[Math.floor(sortedValues.length * 0.75)];
                        
                        // 保存结果
                        instance.result = {
                            type: 'descriptive',
                            stats: {
                                minValue: minValue.toFixed(2),
                                maxValue: maxValue.toFixed(2),
                                mean: mean.toFixed(2),
                                variance: variance.toFixed(2),
                                q25: q25.toFixed(2),
                                q50: q50.toFixed(2),
                                q75: q75.toFixed(2)
                            }
                        };
                        
                        renderAnalysisInstances();
                        alert('描述性分析完成');
                    } else {
                        alert('没有可用的数据进行分析');
                    }
                })
                .catch(error => {
                    console.error('分析失败:', error);
                    alert('分析失败，请查看控制台了解详情');
                });
        }
        
        // 执行趋势性分析
        function performTrendAnalysis(instance) {
            const pointIndex = instance.dataPoints[0].index;
            const point = selectedPoints[pointIndex];
            
            if (!point) {
                alert('数据点不存在');
                return;
            }
            
            // 检查是否应该使用清洗后的数据
            let useCleanedData = false;
            let cleaningConfig = null;
            
            // 查找应用于该数据点的数据清洗实例
            for (const cleaningInstance of dataCleaningInstances) {
                if (cleaningInstance.useCleanedData) {
                    if (cleaningInstance.targetType === 'all' || 
                        (cleaningInstance.targetType === 'specific' && cleaningInstance.targetPointIndex === pointIndex)) {
                        useCleanedData = true;
                        cleaningConfig = cleaningInstance.config;
                        break;
                    }
                }
            }
            
            // 获取历史数据
            fetch(`/api/property-history/${point.deviceId}/${point.id}?limit=1000`)
                .then(response => response.json())
                .then(data => {
                    console.log('趋势分析数据:', data); // 调试信息
                    if (data.success && data.data.length > 0) {
                        // 提取数值
                        let values = data.data.map(item => parseFloat(item.value)).filter(val => !isNaN(val));
                        
                        // 如果需要使用清洗后的数据，则应用数据清洗
                        if (useCleanedData) {
                            values = applyDataCleaning(values, cleaningConfig);
                        }
                        
                        if (values.length < 2) {
                            alert('数据点不足，无法进行趋势分析');
                            return;
                        }
                        
                        // 简单线性回归计算趋势
                        const n = values.length;
                        let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
                        
                        for (let i = 0; i < n; i++) {
                            const x = i;
                            const y = values[i];
                            sumX += x;
                            sumY += y;
                            sumXY += x * y;
                            sumXX += x * x;
                        }
                        
                        // 计算斜率
                        const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                        
                        // 确定趋势类型
                        let trendType = '无明显趋势';
                        if (slope > 0.1) {
                            trendType = '上升趋势';
                        } else if (slope < -0.1) {
                            trendType = '下降趋势';
                        }
                        
                        // 保存结果
                        instance.result = {
                            type: 'trend',
                            trend: {
                                slope: slope.toFixed(4),
                                type: trendType
                            }
                        };
                        
                        renderAnalysisInstances();
                        alert('趋势性分析完成');
                    } else {
                        alert('没有可用的数据进行分析');
                    }
                })
                .catch(error => {
                    console.error('分析失败:', error);
                    alert('分析失败，请查看控制台了解详情');
                });
        }
        
        // 执行相关性分析
        function performCorrelationAnalysis(instance) {
            if (instance.dataPoints.length < 2) {
                alert('相关性分析需要至少两个数据点');
                return;
            }
            
            // 获取所有数据点的历史数据
            const promises = instance.dataPoints.map(dp => {
                const point = selectedPoints[dp.index];
                return fetch(`/api/property-history/${point.deviceId}/${point.id}?limit=1000`)
                    .then(response => response.json())
                    .then(data => {
                        console.log(`相关性分析数据-${dp.index}:`, data); // 调试信息
                        return {
                            name: `${point.deviceName} - ${point.name}`,
                            data: data.success ? data.data : [],
                            index: dp.index
                        };
                    });
            });
            
            Promise.all(promises)
                .then(results => {
                    // 检查数据有效性
                    for (let i = 0; i < results.length; i++) {
                        if (!results[i].data || results[i].data.length === 0) {
                            alert(`数据点 ${results[i].name} 没有可用数据`);
                            return;
                        }
                    }
                    
                    // 提取数值
                    let valueArrays = results.map(result => 
                        result.data.map(item => parseFloat(item.value)).filter(val => !isNaN(val))
                    );
                    
                    // 应用数据清洗（如果需要）
                    for (let i = 0; i < valueArrays.length; i++) {
                        const pointIndex = results[i].index;
                        let useCleanedData = false;
                        let cleaningConfig = null;
                        
                        // 查找应用于该数据点的数据清洗实例
                        for (const cleaningInstance of dataCleaningInstances) {
                            if (cleaningInstance.useCleanedData) {
                                if (cleaningInstance.targetType === 'all' || 
                                    (cleaningInstance.targetType === 'specific' && cleaningInstance.targetPointIndex === pointIndex)) {
                                    useCleanedData = true;
                                    cleaningConfig = cleaningInstance.config;
                                    break;
                                }
                            }
                        }
                        
                        // 如果需要使用清洗后的数据，则应用数据清洗
                        if (useCleanedData) {
                            valueArrays[i] = applyDataCleaning(valueArrays[i], cleaningConfig);
                        }
                    }
                    
                    // 确保所有数组长度一致（取最短的）
                    const minLength = Math.min(...valueArrays.map(arr => arr.length));
                    const trimmedArrays = valueArrays.map(arr => arr.slice(0, minLength));
                    
                    // 计算协方差矩阵
                    const covMatrix = [];
                    for (let i = 0; i < trimmedArrays.length; i++) {
                        covMatrix[i] = [];
                        for (let j = 0; j < trimmedArrays.length; j++) {
                            if (i === j) {
                                // 方差
                                const mean = trimmedArrays[i].reduce((sum, val) => sum + val, 0) / trimmedArrays[i].length;
                                const variance = trimmedArrays[i].reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / trimmedArrays[i].length;
                                covMatrix[i][j] = variance.toFixed(4);
                            } else {
                                // 协方差
                                const mean1 = trimmedArrays[i].reduce((sum, val) => sum + val, 0) / trimmedArrays[i].length;
                                const mean2 = trimmedArrays[j].reduce((sum, val) => sum + val, 0) / trimmedArrays[j].length;
                                
                                let covariance = 0;
                                for (let k = 0; k < minLength; k++) {
                                    covariance += (trimmedArrays[i][k] - mean1) * (trimmedArrays[j][k] - mean2);
                                }
                                covariance /= minLength;
                                covMatrix[i][j] = covariance.toFixed(4);
                            }
                        }
                    }
                    
                    // 保存结果
                    instance.result = {
                        type: 'correlation',
                        covarianceMatrix: covMatrix,
                        dataPointNames: results.map(r => r.name)
                    };
                    
                    renderAnalysisInstances();
                    alert('相关性分析完成');
                })
                .catch(error => {
                    console.error('分析失败:', error);
                    alert('分析失败，请查看控制台了解详情');
                });
        }
        
        // 应用数据清洗
        function applyDataCleaning(values, config) {
            if (!config) return values;
            
            let cleanedValues = [...values];
            
            // 基于上下限的剔除
            if (config.lowerLimit !== null || config.upperLimit !== null) {
                cleanedValues = cleanedValues.filter(val => {
                    if (config.lowerLimit !== null && val < config.lowerLimit) return false;
                    if (config.upperLimit !== null && val > config.upperLimit) return false;
                    return true;
                });
            }
            
            // 基于方差的异常点剔除
            if (config.varianceThreshold !== null) {
                const mean = cleanedValues.reduce((sum, val) => sum + val, 0) / cleanedValues.length;
                const stdDev = Math.sqrt(cleanedValues.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / cleanedValues.length);
                const threshold = stdDev * config.varianceThreshold;
                
                cleanedValues = cleanedValues.filter(val => Math.abs(val - mean) <= threshold);
            }
            
            // TODO: 插值对齐功能需要更复杂的实现
            
            return cleanedValues;
        }
        
        // 执行所有分析
        function performAllAnalysis() {
            if (analysisInstances.length === 0) {
                alert('请至少添加一个分析实例');
                return;
            }
            
            // 检查是否有描述性分析以外的实例
            let hasNonDescriptive = false;
            analysisInstances.forEach(instance => {
                if (instance.type !== 'descriptive') {
                    hasNonDescriptive = true;
                } else {
                    executeAnalysisInstance(instance.id);
                }
            });
            
            if (hasNonDescriptive) {
                alert('注意：只有描述性分析被执行，其他类型的分析方法待定义');
            } else {
                alert('所有分析已完成');
            }
        }
        
        // 渲染分析实例
        function renderAnalysisInstances() {
            const container = document.getElementById('analysis-instances-list');
            
            if (analysisInstances.length === 0) {
                container.innerHTML = '<p>暂无分析实例，请添加分析实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            analysisInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'analysis-instance';
                
                let html = `
                    <div class="analysis-instance-header">
                        <div><strong>分析实例 #${instance.id + 1}</strong></div>
                        <div>
                            <button class="execute-instance" onclick="executeAnalysisInstance(${instance.id})">执行分析</button>
                            <button class="remove-instance" onclick="removeAnalysisInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>分析类型:</label>
                            <select onchange="updateAnalysisType(${instance.id}, this.value)">
                                <option value="descriptive" ${instance.type === 'descriptive' ? 'selected' : ''}>描述性分析</option>
                                <option value="diagnostic" ${instance.type === 'diagnostic' ? 'selected' : ''}>诊断性分析</option>
                                <option value="predictive" ${instance.type === 'predictive' ? 'selected' : ''}>预测性分析</option>
                                <option value="prescriptive" ${instance.type === 'prescriptive' ? 'selected' : ''}>决策性分析</option>
                            </select>
                        </div>
                `;
                
                // 只有描述性分析才显示方法选择
                if (instance.type === 'descriptive') {
                    html += `
                        <div class="form-group">
                            <label>分析方法:</label>
                            <select onchange="updateAnalysisMethod(${instance.id}, this.value)">
                                <option value="descriptive" ${instance.method === 'descriptive' ? 'selected' : ''}>数据特征分析</option>
                                <option value="trend" ${instance.method === 'trend' ? 'selected' : ''}>趋势性分析</option>
                                <option value="correlation" ${instance.method === 'correlation' ? 'selected' : ''}>相关性分析</option>
                            </select>
                        </div>
                    `;
                }
                
                html += `
                    </div>
                `;
                
                // 只有描述性分析才显示数据点选择
                if (instance.type === 'descriptive') {
                    html += `
                        <div class="analysis-method-config">
                            <h4>数据点选择:</h4>
                    `;
                    
                    // 显示已选择的数据点（使用复选框）
                    if (instance.dataPoints.length > 0) {
                        html += '<div>';
                        instance.dataPoints.forEach(dp => {
                            html += `
                                <div>
                                    <label>
                                        <input type="checkbox" checked disabled>
                                        ${dp.deviceName} - ${dp.propertyName}
                                    </label>
                                </div>
                            `;
                        });
                        html += '</div>';
                    } else {
                        html += '<p>暂未选择数据点</p>';
                    }
                    
                    // 显示可选择的数据点（使用复选框）
                    if (selectedPoints.length > 0) {
                        html += '<div style="margin-top: 10px;">';
                        html += '<h5>可选数据点:</h5>';
                        selectedPoints.forEach((point, index) => {
                            // 检查是否已经选择了该数据点
                            const isSelected = instance.dataPoints.some(dp => dp.index === index);
                            if (!isSelected) {
                                html += `
                                    <div>
                                        <label>
                                            <input type="checkbox" onchange="toggleDataPointSelection(${instance.id}, ${index}, this.checked)">
                                            ${point.deviceName} - ${point.name}
                                        </label>
                                    </div>
                                `;
                            }
                        });
                        html += '</div>';
                    } else {
                        html += '<p>请先导入数据点</p>';
                    }
                    
                    html += '</div>'; // end analysis-method-config
                } else {
                    // 对于其他类型的分析，显示待定义消息
                    html += `
                        <div class="analysis-method-config">
                            <p>此分析类型的分析方法待定义</p>
                        </div>
                    `;
                }
                
                // 显示分析结果（仅适用于描述性分析）
                if (instance.result && instance.type === 'descriptive') {
                    html += `
                        <div class="analysis-result">
                            <h4>分析结果:</h4>
                    `;
                    
                    if (instance.result.type === 'descriptive') {
                        const stats = instance.result.stats;
                        html += `
                            <div class="analysis-stats">
                                <div class="stat-item">
                                    <div>最小值</div>
                                    <div class="stat-value">${stats.minValue}</div>
                                </div>
                                <div class="stat-item">
                                    <div>最大值</div>
                                    <div class="stat-value">${stats.maxValue}</div>
                                </div>
                                <div class="stat-item">
                                    <div>平均值</div>
                                    <div class="stat-value">${stats.mean}</div>
                                </div>
                                <div class="stat-item">
                                    <div>方差</div>
                                    <div class="stat-value">${stats.variance}</div>
                                </div>
                                <div class="stat-item">
                                    <div>25% 分位数</div>
                                    <div class="stat-value">${stats.q25}</div>
                                </div>
                                <div class="stat-item">
                                    <div>50% 分位数</div>
                                    <div class="stat-value">${stats.q50}</div>
                                </div>
                                <div class="stat-item">
                                    <div>75% 分位数</div>
                                    <div class="stat-value">${stats.q75}</div>
                                </div>
                            </div>
                        `;
                    }
                    
                    html += '</div>'; // end analysis-result
                }
                
                instanceElement.innerHTML = html;
                container.appendChild(instanceElement);
            });
        }
        
        // 切换数据点选择
        function toggleDataPointSelection(instanceId, pointIndex, isChecked) {
            if (isChecked) {
                addDataPointToInstance(instanceId, pointIndex);
            } else {
                removeDataPointFromInstance(instanceId, pointIndex);
            }
        }
        
        // 添加数据清洗实例
        function addDataCleaningInstance() {
            const instanceId = dataCleaningInstanceIdCounter++;
            
            const instance = {
                id: instanceId,
                targetType: 'all',
                targetPointIndex: null,
                useCleanedData: false,
                config: {
                    lowerLimit: null,
                    upperLimit: null,
                    varianceThreshold: null
                }
            };
            
            dataCleaningInstances.push(instance);
            renderDataCleaningInstances();
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 更新数据清洗实例的目标类型
        function updateDataCleaningTargetType(instanceId, targetType) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetType = targetType;
                if (targetType === 'all') {
                    instance.targetPointIndex = null;
                }
                renderDataCleaningInstances();
            }
        }
        
        // 更新数据清洗实例的目标数据点
        function updateDataCleaningTargetPoint(instanceId, pointIndex) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetPointIndex = pointIndex;
                renderDataCleaningInstances();
            }
        }
        
        // 更新数据清洗实例的使用状态
        function updateDataCleaningUseState(instanceId, useCleanedData) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.useCleanedData = useCleanedData;
                renderDataCleaningInstances();
            }
        }
        
        // 更新数据清洗实例的配置
        function updateDataCleaningConfig(instanceId, config) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config = config;
                renderDataCleaningInstances();
            }
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-instances-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加数据清洗实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'data-cleaning-instance';
                
                let html = `
                    <div class="data-cleaning-instance-header">
                        <div><strong>数据清洗实例 #${instance.id + 1}</strong></div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>目标类型:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                `;
                
                // 如果目标类型为特定数据点，则显示数据点选择
                if (instance.targetType === 'specific') {
                    html += `
                        <div class="form-group">
                            <label>目标数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                <option value="null" ${instance.targetPointIndex === null ? 'selected' : ''}>请选择数据点</option>
                    `;
                    
                    // 显示可选择的数据点
                    if (selectedPoints.length > 0) {
                        selectedPoints.forEach((point, index) => {
                            html += `
                                <option value="${index}" ${instance.targetPointIndex === index ? 'selected' : ''}>${point.deviceName} - ${point.name}</option>
                            `;
                        });
                    } else {
                        html += '<option disabled>请先导入数据点</option>';
                    }
                    
                    html += `
                            </select>
                        </div>
                    `;
                }
                
                html += `
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>使用清洗后的数据:</label>
                            <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateDataCleaningUseState(${instance.id}, this.checked)">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>下限:</label>
                            <input type="number" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, { ...instance.config, lowerLimit: this.value ? parseFloat(this.value) : null })">
                        </div>
                        <div class="form-group">
                            <label>上限:</label>
                            <input type="number" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, { ...instance.config, upperLimit: this.value ? parseFloat(this.value) : null })">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>方差阈值:</label>
                            <input type="number" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, { ...instance.config, varianceThreshold: this.value ? parseFloat(this.value) : null })">
                        </div>
                    </div>
                `;
                
                instanceElement.innerHTML = html;
                container.appendChild(instanceElement);
            });
        }
        
        // 初始化
        pointChart = null;
        analysisInstanceIdCounter = 0;
        analysisInstances = [];
        dataCleaningInstanceIdCounter = 0;
        dataCleaningInstances = [];
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('import-data-button').addEventListener('click', () => {
                const fileInput = document.getElementById('data-file-input');
                if (fileInput.files.length === 0) {
                    alert('请选择一个文件');
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const data = JSON.parse(e.target.result);
                    selectedPoints = data;
                    renderPointList();
                };
                
                reader.readAsText(file);
            });
            
            document.getElementById('point-list').addEventListener('click', (event) => {
                const pointId = event.target.getAttribute('data-point-id');
                if (pointId) {
                    const point = selectedPoints.find(p => p.id == pointId);
                    if (point) {
                        showPointInfo(point);
                    }
                }
            });
        });
        


        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
            
            // 显示对应的内容
            var tabContents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].className = tabContents[i].className.replace(" active", "");
            }
            document.getElementById(tabName).className += " active";
        }
        
        // 添加数据清洗实例
        function addDataCleaningInstance() {
            const instanceId = dataCleaningIdCounter++;
            
            const instance = {
                id: instanceId,
                name: `清洗实例${instanceId + 1}`,
                targetType: 'all', // 默认为所有数据点
                targetPointIndex: null, // 目标数据点索引
                type: 'limit', // 默认为基于上下限的剔除
                useCleanedData: true, // 默认使用清洗后的数据
                config: {
                    lowerLimit: null,
                    upperLimit: null,
                    varianceThreshold: null,
                    interpolationType: 'linear' // 默认线性插值
                }
            };
            
            dataCleaningInstances.push(instance);
            renderDataCleaningInstances();
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 更新数据清洗实例名称
        function updateDataCleaningName(instanceId, name) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.name = name;
            }
        }
        
        // 更新数据清洗实例类型
        function updateDataCleaningType(instanceId, type) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.type = type;
            }
        }
        
        // 更新数据清洗目标类型
        function updateDataCleaningTargetType(instanceId, targetType) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetType = targetType;
                if (targetType === 'specific') {
                    // 如果选择了特定数据点但还没有设置，则默认选择第一个
                    if (selectedPoints.length > 0 && instance.targetPointIndex === null) {
                        instance.targetPointIndex = 0;
                    }
                } else {
                    instance.targetPointIndex = null;
                }
                renderDataCleaningInstances();
            }
        }
        
        // 更新数据清洗目标点位
        function updateDataCleaningTargetPoint(instanceId, pointIndex) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetPointIndex = parseInt(pointIndex);
            }
        }
        
        // 更新数据清洗配置
        function updateDataCleaningConfig(instanceId, configField, value) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config[configField] = value;
            }
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-instances');
            container.innerHTML = '';
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'data-cleaning-instance';
                instanceElement.innerHTML = `
                    <div class="data-cleaning-instance-header">
                        <input type="text" value="${instance.name}" oninput="updateDataCleaningName('${instance.id}', this.value)" placeholder="Instance Name">
                        <select onchange="updateDataCleaningType('${instance.id}', this.value)">
                            <option value="filter" ${instance.type === 'filter' ? 'selected' : ''}>Filter</option>
                            <option value="transform" ${instance.type === 'transform' ? 'selected' : ''}>Transform</option>
                        </select>
                        <button onclick="removeDataCleaningInstance('${instance.id}')">Remove</button>
                    </div>
                    <div class="data-cleaning-instance-body">
                        <div>
                            <label>
                                <input type="radio" name="target-type-${instance.id}" value="all" ${instance.targetType === 'all' ? 'checked' : ''} onchange="updateDataCleaningTargetType('${instance.id}', this.value)">
                                All Data Points
                            </label>
                        </div>
                        <div>
                            <label>
                                <input type="radio" name="target-type-${instance.id}" value="specific" ${instance.targetType === 'specific' ? 'checked' : ''} onchange="updateDataCleaningTargetType('${instance.id}', this.value)">
                                Specific Data Point
                            </label>
                            <select ${instance.targetType !== 'specific' ? 'disabled' : ''} onchange="updateDataCleaningTargetPoint('${instance.id}', this.value)">
                                ${selectedPoints.map((point, index) => `<option value="${index}" ${instance.targetPointIndex === index ? 'selected' : ''}>Point ${index + 1}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label>
                                Configuration:
                                <input type="text" value="${JSON.stringify(instance.config)}" oninput="updateDataCleaningConfig('${instance.id}', 'config', JSON.parse(this.value))">
                            </label>
                        </div>
                    </div>
                `;
                container.appendChild(instanceElement);
            });
        }
        
        // 初始化数据清洗实例
        function initializeDataCleaning() {
            renderDataCleaningInstances();
        }
        
        // 添加数据清洗实例
        function addDataCleaningInstance() {
            const newInstanceId = `instance-${dataCleaningInstances.length + 1}`;
            dataCleaningInstances.push({
                id: newInstanceId,
                name: `Instance ${dataCleaningInstances.length + 1}`,
                type: 'filter',
                targetType: 'all',
                targetPointIndex: null,
                config: {}
            });
            renderDataCleaningInstances();
        }
        
        // 更新数据清洗配置
        function updateDataCleaningConfig(instanceId, configField, value) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config[configField] = value !== '' ? Number(value) : null;
            }
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-instances');
            container.innerHTML = '';
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'data-cleaning-instance';
                instanceElement.innerHTML = `
                    <div class="data-cleaning-instance-header">
                        <input type="text" value="${instance.name}" oninput="updateDataCleaningName('${instance.id}', this.value)">
                        <button onclick="removeDataCleaningInstance('${instance.id}')">删除</button>
                    </div>
                    <div class="data-cleaning-instance-body">
                        <label>
                            <span>目标类型:</span>
                            <select onchange="updateDataCleaningTargetType('${instance.id}', this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </label>
                        <label>
                            <span>目标数据点:</span>
                            <select ${instance.targetType !== 'specific' ? 'disabled' : ''} onchange="updateDataCleaningTargetPoint('${instance.id}', this.value)">
                                ${selectedPoints.map((point, index) => `<option value="${index}" ${instance.targetPointIndex === index ? 'selected' : ''}>Point ${index + 1}</option>`).join('')}
                            </select>
                        </label>
                        <label>
                            <span>类型:</span>
                            <select onchange="updateDataCleaningType('${instance.id}', this.value)">
                                <option value="filter" ${instance.type === 'filter' ? 'selected' : ''}>Filter</option>
                                <option value="transform" ${instance.type === 'transform' ? 'selected' : ''}>Transform</option>
                            </select>
                        </label>
                        <label>
                            <span>Configuration:</span>
                            <input type="text" value="${JSON.stringify(instance.config)}" oninput="updateDataCleaningConfig('${instance.id}', 'config', JSON.parse(this.value))">
                        </label>
                    </div>
                `;
                container.appendChild(instanceElement);
            });
        }
        

        
        // 更新插值类型
        function updateInterpolationType(instanceId, type) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config.interpolationType = type;
            }
        }
        
        // 更新是否使用清洗后数据
        function updateUseCleanedData(instanceId, useCleaned) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.useCleanedData = useCleaned;
            }
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
            
            // 显示对应的内容
            var tabContents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].className = tabContents[i].className.replace(" active", "");
            }
            document.getElementById(tabName).className += " active";
        }
        
        // 添加数据清洗实例
        function addDataCleaningInstance() {
            const instanceId = dataCleaningIdCounter++;
            
            const instance = {
                id: instanceId,
                name: `清洗实例${instanceId + 1}`,
                targetType: 'all', // 默认为所有数据点
                targetPointIndex: null, // 目标数据点索引
                type: 'limit', // 默认为基于上下限的剔除
                useCleanedData: true, // 默认使用清洗后的数据
                config: {
                    lowerLimit: null,
                    upperLimit: null,
                    varianceThreshold: null,
                    interpolationType: 'linear' // 默认线性插值
                }
            };
            
            dataCleaningInstances.push(instance);
            renderDataCleaningInstances();
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 更新数据清洗实例名称
        function updateDataCleaningName(instanceId, name) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.name = name;
            }
        }
        
        // 更新数据清洗实例类型
        function updateDataCleaningType(instanceId, type) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.type = type;
            }
        }
        
        // 更新数据清洗目标类型
        function updateDataCleaningTargetType(instanceId, targetType) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetType = targetType;
                if (targetType === 'specific') {
                    // 如果选择了特定数据点但还没有设置，则默认选择第一个
                    if (selectedPoints.length > 0 && instance.targetPointIndex === null) {
                        instance.targetPointIndex = 0;
                    }
                } else {
                    instance.targetPointIndex = null;
                }
                renderDataCleaningInstances();
            }
        }
        
        // 更新数据清洗目标点位
        function updateDataCleaningTargetPoint(instanceId, pointIndex) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetPointIndex = parseInt(pointIndex);
            }
        }
        
        // 更新数据清洗配置
        function updateDataCleaningConfig(instanceId, configField, value) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config[configField] = value !== '' ? Number(value) : null;
            }
        }
        
        // 更新插值类型
        function updateInterpolationType(instanceId, type) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config.interpolationType = type;
            }
        }
        
        // 更新是否使用清洗后数据
        function updateUseCleanedData(instanceId, useCleaned) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.useCleanedData = useCleaned;
            }
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
            
            // 显示对应的内容
            var tabContents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].className = tabContents[i].className.replace(" active", "");
            }
            document.getElementById(tabName).className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
            
            // 显示对应的内容
            var tabContents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].className = tabContents[i].className.replace(" active", "");
            }
            document.getElementById(tabName).className += " active";
        }
        
        // 添加数据清洗实例
        function addDataCleaningInstance() {
            const instanceId = dataCleaningIdCounter++;
            
            const instance = {
                id: instanceId,
                name: `清洗实例${instanceId + 1}`,
                targetType: 'all', // 默认为所有数据点
                targetPointIndex: null, // 目标数据点索引
                type: 'limit', // 默认为基于上下限的剔除
                useCleanedData: true, // 默认使用清洗后的数据
                config: {
                    lowerLimit: null,
                    upperLimit: null,
                    varianceThreshold: null,
                    interpolationType: 'linear' // 默认线性插值
                }
            };
            
            dataCleaningInstances.push(instance);
            renderDataCleaningInstances();
        }
        
        // 移除数据清洗实例
        function removeDataCleaningInstance(instanceId) {
            dataCleaningInstances = dataCleaningInstances.filter(instance => instance.id !== instanceId);
            renderDataCleaningInstances();
        }
        
        // 更新数据清洗实例名称
        function updateDataCleaningName(instanceId, name) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.name = name;
            }
        }
        
        // 更新数据清洗实例类型
        function updateDataCleaningType(instanceId, type) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.type = type;
            }
        }
        
        // 更新数据清洗目标类型
        function updateDataCleaningTargetType(instanceId, targetType) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetType = targetType;
                if (targetType === 'specific') {
                    // 如果选择了特定数据点但还没有设置，则默认选择第一个
                    if (selectedPoints.length > 0 && instance.targetPointIndex === null) {
                        instance.targetPointIndex = 0;
                    }
                } else {
                    instance.targetPointIndex = null;
                }
                renderDataCleaningInstances();
            }
        }
        
        // 更新数据清洗目标点位
        function updateDataCleaningTargetPoint(instanceId, pointIndex) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.targetPointIndex = parseInt(pointIndex);
            }
        }
        
        // 更新数据清洗配置
        function updateDataCleaningConfig(instanceId, configField, value) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config[configField] = value !== '' ? Number(value) : null;
            }
        }
        
        // 更新插值类型
        function updateInterpolationType(instanceId, type) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config.interpolationType = type;
            }
        }
        
        // 更新是否使用清洗后数据
        function updateUseCleanedData(instanceId, useCleaned) {
            const instance = dataCleaningInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.useCleanedData = useCleaned;
            }
        }
        
        // 当导入的数据点发生变化时，更新数据清洗实例中的点位选择
        function updateDataCleaningPointReferences() {
            // 当数据点发生变更时，检查是否有数据清洗实例引用了已被删除的点位
            dataCleaningInstances.forEach(instance => {
                if (instance.targetType === 'specific' && instance.targetPointIndex !== null) {
                    // 检查引用的点位是否还存在
                    if (instance.targetPointIndex >= selectedPoints.length) {
                        // 如果引用的点位已被删除，重置为目标点位为null或者指向最后一个点位
                        if (selectedPoints.length > 0) {
                            instance.targetPointIndex = selectedPoints.length - 1;
                        } else {
                            instance.targetPointIndex = null;
                        }
                    }
                }
            });
            renderDataCleaningInstances();
        }
        
        // 渲染数据清洗实例
        function renderDataCleaningInstances() {
            const container = document.getElementById('data-cleaning-list');
            
            if (dataCleaningInstances.length === 0) {
                container.innerHTML = '<p>暂无数据清洗实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            dataCleaningInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                // 生成数据点选项
                let pointOptions = '';
                if (selectedPoints.length > 0) {
                    selectedPoints.forEach((point, index) => {
                        const isSelected = instance.targetPointIndex === index;
                        pointOptions += `<option value="${index}" ${isSelected ? 'selected' : ''}>${point.name}</option>`;
                    });
                } else {
                    pointOptions = '<option value="">请先导入数据点</option>';
                }
                
                let configHtml = '';
                if (instance.type === 'limit') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>下限值:</label>
                                <input type="number" step="any" value="${instance.config.lowerLimit !== null ? instance.config.lowerLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'lowerLimit', this.value)">
                            </div>
                            <div class="form-group">
                                <label>上限值:</label>
                                <input type="number" step="any" value="${instance.config.upperLimit !== null ? instance.config.upperLimit : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'upperLimit', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'variance') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>方差阈值:</label>
                                <input type="number" step="any" value="${instance.config.varianceThreshold !== null ? instance.config.varianceThreshold : ''}" onchange="updateDataCleaningConfig(${instance.id}, 'varianceThreshold', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'interpolation') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>插值方式:</label>
                                <select onchange="updateInterpolationType(${instance.id}, this.value)">
                                    <option value="linear" ${instance.config.interpolationType === 'linear' ? 'selected' : ''}>线性插值</option>
                                    <option value="quadratic" ${instance.config.interpolationType === 'quadratic' ? 'selected' : ''}>二次插值</option>
                                </select>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateDataCleaningName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeDataCleaningInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗对象:</label>
                            <select onchange="updateDataCleaningTargetType(${instance.id}, this.value)">
                                <option value="all" ${instance.targetType === 'all' ? 'selected' : ''}>所有导入的数据点</option>
                                <option value="specific" ${instance.targetType === 'specific' ? 'selected' : ''}>特定数据点</option>
                            </select>
                        </div>
                        
                        ${instance.targetType === 'specific' ? `
                        <div class="form-group">
                            <label>选择数据点:</label>
                            <select onchange="updateDataCleaningTargetPoint(${instance.id}, this.value)">
                                ${pointOptions}
                            </select>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>清洗类型:</label>
                            <select onchange="updateDataCleaningType(${instance.id}, this.value)">
                                <option value="limit" ${instance.type === 'limit' ? 'selected' : ''}>基于上下限的剔除</option>
                                <option value="variance" ${instance.type === 'variance' ? 'selected' : ''}>基于方差的异常点剔除</option>
                                <option value="interpolation" ${instance.type === 'interpolation' ? 'selected' : ''}>插值对齐</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useCleanedData ? 'checked' : ''} onchange="updateUseCleanedData(${instance.id}, this.checked)">
                                使用清洗后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }

        // 切换标签页
        function switchTab(element, tabName) {
            // 更新标签页按钮状态
            var tabs = document.getElementsByClassName("tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].className = tabs[i].className.replace(" active", "");
            }
            element.className += " active";
            
            // 显示对应的内容
            var tabContents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].className = tabContents[i].className.replace(" active", "");
            }
            document.getElementById(tabName).className += " active";
        }
        
        // 添加特征提取实例
        function addFeatureExtractionInstance() {
            const instanceId = featureExtractionIdCounter++;
            
            const instance = {
                id: instanceId,
                name: `特征实例${instanceId + 1}`,
                type: 'smoothing', // 默认为数据平滑处理
                useExtractedData: true, // 默认使用特征提取后的数据
                config: {
                    smoothingFactor: 0.1,
                    expression: '' // 代数运算表达式
                }
            };
            
            featureExtractionInstances.push(instance);
            renderFeatureExtractionInstances();
        }
        
        // 移除特征提取实例
        function removeFeatureExtractionInstance(instanceId) {
            featureExtractionInstances = featureExtractionInstances.filter(instance => instance.id !== instanceId);
            renderFeatureExtractionInstances();
        }
        
        // 更新特征提取实例名称
        function updateFeatureExtractionName(instanceId, name) {
            const instance = featureExtractionInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.name = name;
            }
        }
        
        // 更新特征提取实例类型
        function updateFeatureExtractionType(instanceId, type) {
            const instance = featureExtractionInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.type = type;
            }
        }
        
        // 更新特征提取配置
        function updateFeatureExtractionConfig(instanceId, configField, value) {
            const instance = featureExtractionInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.config[configField] = value;
            }
        }
        
        // 更新是否使用特征提取后数据
        function updateUseExtractedData(instanceId, useExtracted) {
            const instance = featureExtractionInstances.find(instance => instance.id === instanceId);
            if (instance) {
                instance.useExtractedData = useExtracted;
            }
        }
        
        // 渲染特征提取实例
        function renderFeatureExtractionInstances() {
            const container = document.getElementById('feature-extraction-list');
            
            if (featureExtractionInstances.length === 0) {
                container.innerHTML = '<p>暂无特征提取实例，请添加实例</p>';
                return;
            }
            
            container.innerHTML = '';
            
            featureExtractionInstances.forEach(instance => {
                const instanceElement = document.createElement('div');
                instanceElement.className = 'processing-instance';
                
                let configHtml = '';
                if (instance.type === 'smoothing') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>平滑因子 (0-1):</label>
                                <input type="number" step="0.01" min="0" max="1" value="${instance.config.smoothingFactor}" onchange="updateFeatureExtractionConfig(${instance.id}, 'smoothingFactor', this.value)">
                            </div>
                        </div>
                    `;
                } else if (instance.type === 'algebraic') {
                    configHtml = `
                        <div class="form-row">
                            <div class="form-group">
                                <label>代数运算表达式:</label>
                                <input type="text" value="${instance.config.expression}" onchange="updateFeatureExtractionConfig(${instance.id}, 'expression', this.value)" placeholder="例如: point1 + point2 * 0.5">
                                <small>可使用的点位: ${selectedPoints.map((p, i) => `point${i+1}(${p.name})`).join(', ')}</small>
                            </div>
                        </div>
                    `;
                }
                
                instanceElement.innerHTML = `
                    <div class="processing-instance-header">
                        <div>
                            <input type="text" value="${instance.name}" onchange="updateFeatureExtractionName(${instance.id}, this.value)" style="font-weight: bold; border: 1px solid #ccc; border-radius: 4px; padding: 5px;">
                        </div>
                        <div>
                            <button class="remove-instance" onclick="removeFeatureExtractionInstance(${instance.id})">移除</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>特征类型:</label>
                            <select onchange="updateFeatureExtractionType(${instance.id}, this.value)">
                                <option value="smoothing" ${instance.type === 'smoothing' ? 'selected' : ''}>数据平滑处理</option>
                                <option value="algebraic" ${instance.type === 'algebraic' ? 'selected' : ''}>代数运算</option>
                            </select>
                        </div>
                    </div>
                    
                    ${configHtml}
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" ${instance.useExtractedData ? 'checked' : ''} onchange="updateUseExtractedData(${instance.id}, this.checked)">
                                使用特征提取后的数据进行分析
                            </label>
                        </div>
                    </div>
                `;
                
                container.appendChild(instanceElement);
            });
        }
        
        // 切换数据点选择
        function toggleDataPointSelection(instanceId, pointIndex, isChecked) {
            const instance = analysisInstances.find(instance => instance.id === instanceId);
            if (instance) {
                if (isChecked) {
                    // 添加数据点
                    addDataPointToInstance(instanceId, pointIndex);
                } else {
                    // 移除数据点
                    removeDataPointFromInstance(instanceId, pointIndex);
                }
            }
        }
        
        // 保存分析结果
        function saveAnalysisResult() {
            if (!projectId) {
                alert('项目ID不存在，无法保存结果');
                return;
            }
            
            const resultName = document.getElementById('result-name').value;
            if (!resultName) {
                alert('请输入分析结果名称');
                return;
            }
            
            // 获取结论说明文本
            const conclusionText = document.getElementById('conclusion-textarea').value;
            
            const data = {
                project_id: projectId,
                name: resultName,
                data_points: JSON.stringify(selectedPoints),
                chart_data: '', // 可以根据需要添加图表数据
                statistics: '', // 可以根据需要添加统计数据
                analysis_result: conclusionText
            };
            
            // 显示加载状态
            const saveBtn = document.getElementById('save-result-btn');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = '保存中...';
            saveBtn.disabled = true;
            
            fetch('/api/data-analysis-results', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('分析结果保存成功！');
                    document.getElementById('result-name').value = '';
                    document.getElementById('conclusion-textarea').value = '';
                    loadSavedAnalysisResults(); // 重新加载保存的结果列表
                } else {
                    alert('保存失败: ' + data.message);
                }
            })
            .catch(error => {
                console.error('保存失败:', error);
                alert('保存失败，请查看控制台了解详情');
            })
            .finally(() => {
                // 恢复按钮状态
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            });
        }
        
        // 加载已保存的分析结果
        function loadSavedAnalysisResults() {
            if (!projectId) return;
            
            fetch(`/api/data-analysis-results/project/${projectId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        analysisResults = data.data;
                        renderSavedAnalysisResults();
                    } else {
                        console.error('加载分析结果失败:', data.message);
                    }
                })
                .catch(error => {
                    console.error('加载分析结果失败:', error);
                });
        }
        
        // 渲染已保存的分析结果
        function renderSavedAnalysisResults() {
            const container = document.getElementById('saved-results-list');
            
            if (analysisResults.length === 0) {
                container.innerHTML = '<p>暂无保存的分析结果</p>';
                return;
            }
            
            container.innerHTML = '';
            analysisResults.forEach(result => {
                const resultElement = document.createElement('div');
                resultElement.className = 'saved-result-item';
                resultElement.innerHTML = `
                    <div>
                        <strong>${result.name}</strong> - ${new Date(result.created_at).toLocaleString()}
                    </div>
                    <div class="action-buttons">
                        <button class="load-btn" onclick="loadAnalysisResult(${result.id})">加载</button>
                        <button class="delete-btn" onclick="deleteAnalysisResult(${result.id})">删除</button>
                    </div>
                `;
                container.appendChild(resultElement);
            });
        }
        
        // 加载分析结果
        function loadAnalysisResult(resultId) {
            fetch(`/api/data-analysis-results/${resultId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const result = data.data;
                        // 在实际应用中，这里会加载保存的分析数据并重新渲染图表
                        alert(`已加载分析结果: ${result.name}\n创建时间: ${new Date(result.created_at).toLocaleString()}\n\n在实际应用中，这里会加载保存的分析数据并重新渲染图表。`);
                    } else {
                        alert('加载失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('加载失败:', error);
                    alert('加载失败，请查看控制台了解详情');
                });
        }
        
        // 删除分析结果
        function deleteAnalysisResult(resultId) {
            if (!confirm('确定要删除这个分析结果吗？')) {
                return;
            }
            
            fetch(`/api/data-analysis-results/${resultId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('删除成功！');
                    loadSavedAnalysisResults(); // 重新加载保存的结果列表
                } else {
                    alert('删除失败: ' + data.message);
                }
            })
            .catch(error => {
                console.error('删除失败:', error);
                alert('删除失败，请查看控制台了解详情');
            });
        }
        
        // 保存分析项目
        function saveAnalysisProject() {
            if (!projectId) {
                alert('项目ID不存在，无法保存结果');
                return;
            }
            
            // 获取结论说明文本
            const conclusionText = document.getElementById('conclusion-textarea').value;
            
            // 准备要保存的数据
            const projectData = {
                selected_points: JSON.stringify(selectedPoints),
                analysis_instances: JSON.stringify(analysisInstances),
                data_cleaning_instances: JSON.stringify(dataCleaningInstances),
                feature_extraction_instances: JSON.stringify(featureExtractionInstances),
                conclusion: conclusionText
            };
            
            // 显示加载状态
            const saveBtn = document.getElementById('save-project-btn');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = '保存中...';
            saveBtn.disabled = true;
            
            fetch(`/api/data-analysis-projects/${projectId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(projectData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('分析项目保存成功！');
                    loadSavedAnalysisResults(); // 重新加载保存的结果列表
                } else {
                    alert('保存失败: ' + data.message);
                }
            })
            .catch(error => {
                console.error('保存失败:', error);
                alert('保存失败，请查看控制台了解详情');
            })
            .finally(() => {
                // 恢复按钮状态
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            });
        }
        
        // 加载分析项目数据
        function loadAnalysisProjectData() {
            if (!projectId) return;
            
            fetch(`/api/data-analysis-projects/${projectId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const project = data.data;
                        
                        // 加载选中的点位
                        if (project.selected_points) {
                            try {
                                selectedPoints = JSON.parse(project.selected_points);
                                renderSelectedPoints(); // 重新渲染选中的点位
                            } catch (e) {
                                console.error('解析选中点位数据失败:', e);
                            }
                        }
                        
                        // 加载分析实例
                        if (project.analysis_instances) {
                            try {
                                analysisInstances = JSON.parse(project.analysis_instances);
                                // 更新计数器以避免ID冲突
                                analysisInstanceIdCounter = Math.max(...analysisInstances.map(i => i.id), 0) + 1;
                                renderAnalysisInstances(); // 重新渲染分析实例
                            } catch (e) {
                                console.error('解析分析实例数据失败:', e);
                            }
                        }
                        
                        // 加载数据清洗实例
                        if (project.data_cleaning_instances) {
                            try {
                                dataCleaningInstances = JSON.parse(project.data_cleaning_instances);
                                // 更新计数器以避免ID冲突
                                dataCleaningIdCounter = Math.max(...dataCleaningInstances.map(i => i.id), 0) + 1;
                                renderDataCleaningInstances(); // 重新渲染数据清洗实例
                            } catch (e) {
                                console.error('解析数据清洗实例数据失败:', e);
                            }
                        }
                        
                        // 加载特征提取实例
                        if (project.feature_extraction_instances) {
                            try {
                                featureExtractionInstances = JSON.parse(project.feature_extraction_instances);
                                // 更新计数器以避免ID冲突
                                featureExtractionIdCounter = Math.max(...featureExtractionInstances.map(i => i.id), 0) + 1;
                                renderFeatureExtractionInstances(); // 重新渲染特征提取实例
                            } catch (e) {
                                console.error('解析特征提取实例数据失败:', e);
                            }
                        }
                        
                        // 加载结论说明
                        if (project.conclusion) {
                            document.getElementById('conclusion-textarea').value = project.conclusion;
                        }
                    } else {
                        console.error('加载分析项目数据失败:', data.message);
                    }
                })
                .catch(error => {
                    console.error('加载分析项目数据失败:', error);
                });
        }
        
        // 渲染选中的点位
        function renderSelectedPoints() {
            const container = document.getElementById('selected-transfer-points-list');
            
            // 清除"暂未选择数据点"的提示
            if (container.innerHTML.includes('暂未选择数据点')) {
                container.innerHTML = '';
            }
            
            if (selectedPoints.length === 0) {
                container.innerHTML = '<p>暂未选择数据点</p>';
                return;
            }
            
            // 清空容器
            container.innerHTML = '';
            
            // 添加每个选中的点位
            selectedPoints.forEach(point => {
                const pointElement = document.createElement('div');
                pointElement.className = 'transfer-item';
                pointElement.dataset.pointId = point.id;
                pointElement.innerHTML = `
                    <label>
                        <input type="checkbox" class="data-point-checkbox" onchange="updateTransferButtons()">
                        ${point.name} (${point.unit || '无单位'})
                    </label>
                `;
                container.appendChild(pointElement);
            });
            
            // 启用分析按钮
            document.getElementById('perform-analysis-btn').disabled = false;
        }
    </script>
</body>
</html>